-- setup
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

pcall(function()
	if CoreGui:FindFirstChild("WalkToGUI") then
		CoreGui.WalkToGUI:Destroy()
	end
end)

local selectedPlayer
local autoNearest = false
local autoLoop

-- breakvelocity
local function breakVelocity()
	local char = LocalPlayer.Character
	if not char then return end
	local V3 = Vector3.new(0, 0, 0)
	local t = tick() + 1
	while tick() < t do
		for _, v in ipairs(char:GetDescendants()) do
			if v:IsA("BasePart") then
				v.Velocity = V3
				v.RotVelocity = V3
			end
		end
		RunService.Stepped:Wait()
	end
end

local function teleportToPlayer(plr)
	if not plr or not plr.Character then return end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	local targetRoot = plr.Character:FindFirstChild("HumanoidRootPart")
	if root and targetRoot then
		local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if hum and hum.SeatPart then hum.Sit = false task.wait(0.1) end
		root.CFrame = targetRoot.CFrame + Vector3.new(3, 1, 0)
--		breakVelocity()
	end
end

-- gui
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "WalkToGUI"
gui.ResetOnSpawn = false

local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 44, 0, 44)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
toggleBtn.BackgroundTransparency = 0.3
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Text = "Goto"
toggleBtn.Active = true
toggleBtn.Draggable = true

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 200, 0, 160)
frame.Position = UDim2.new(0, 10, 0.5, -80)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.Visible = false

toggleBtn.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

-- dropdown
local dropdown = Instance.new("TextButton", frame)
dropdown.Size = UDim2.new(1, 0, 0, 30)
dropdown.Position = UDim2.new(0, 0, 0, -30)
dropdown.Text = "Select Player"
dropdown.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
dropdown.TextColor3 = Color3.new(1, 1, 1)

local dropdownList = Instance.new("ScrollingFrame", frame)
dropdownList.Size = UDim2.new(1, 0, 0, 120)
dropdownList.Position = UDim2.new(0, 0, 0, 0)
dropdownList.CanvasSize = UDim2.new(0, 0, 0, 0)
dropdownList.ScrollBarThickness = 4
dropdownList.Visible = false
dropdownList.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

dropdown.MouseButton1Click:Connect(function()
	dropdownList.Visible = not dropdownList.Visible
end)

local function refreshDropdown()
	dropdownList:ClearAllChildren()
	local y = 0
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local btn = Instance.new("TextButton", dropdownList)
			btn.Size = UDim2.new(1, 0, 0, 25)
			btn.Position = UDim2.new(0, 0, 0, y)
			btn.Text = plr.Name
			btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
			btn.TextColor3 = Color3.new(1, 1, 1)
			btn.MouseButton1Click:Connect(function()
				selectedPlayer = plr
				dropdown.Text = "Selected: " .. plr.Name
				dropdownList.Visible = false
			end)
			y = y + 25
		end
	end
	dropdownList.CanvasSize = UDim2.new(0, 0, 0, y)
end

task.spawn(function()
	while true do
		if dropdownList.Visible then
			refreshDropdown()
		end
		task.wait(2)
	end
end)

-- goto sec
local gotoBtn = Instance.new("TextButton", frame)
gotoBtn.Size = UDim2.new(1, 0, 0, 30)
gotoBtn.Position = UDim2.new(0, 0, 0, 120)
gotoBtn.Text = "GoTo"
gotoBtn.BackgroundColor3 = Color3.fromRGB(120, 120, 120)
gotoBtn.TextColor3 = Color3.new(1, 1, 1)

gotoBtn.MouseButton1Click:Connect(function()
	if selectedPlayer then
		teleportToPlayer(selectedPlayer)
	end
end)

-- nearest
local gotoNearestBtn = Instance.new("TextButton", frame)
gotoNearestBtn.Size = UDim2.new(1, 0, 0, 30)
gotoNearestBtn.Position = UDim2.new(0, 0, 0, 150)
gotoNearestBtn.Text = "Goto Nearest"
gotoNearestBtn.BackgroundColor3 = Color3.fromRGB(120, 120, 120)
gotoNearestBtn.TextColor3 = Color3.new(1, 1, 1)

gotoNearestBtn.MouseButton1Click:Connect(function()
	local char = LocalPlayer.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	local hum = char and char:FindFirstChildOfClass("Humanoid")
	if not hrp or not hum then return end

	local nearest, minDist = nil, math.huge
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer
		and plr.Character
		and plr.Character:FindFirstChild("HumanoidRootPart")
		and plr.Character:FindFirstChildOfClass("Humanoid")
		and plr.Character.Humanoid.Health > 0 then
			local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
			if dist < minDist then
				minDist = dist
				nearest = plr
			end
		end
	end

	if nearest and nearest.Character and nearest.Character:FindFirstChild("HumanoidRootPart") then
		if hum.SeatPart then hum.Sit = false task.wait(0.1) end
		hrp.CFrame = nearest.Character.HumanoidRootPart.CFrame + Vector3.new(3, 1, 0)
	end
end)